---
const { currentLang } = Astro.props;

/**
 * GitHub Pages base path (e.g. /website-samsara)
 */
const base = import.meta.env.BASE_URL?.replace(/\/$/, "") || "";

// Current URL path (example: /website-samsara/en/contact)
let pathname = Astro.url.pathname;

// Remove BASE_URL from the front so language logic works
if (base && pathname.startsWith(base)) {
  pathname = pathname.slice(base.length) || "/";
}

// Detect language
const isPT = pathname.startsWith("/pt");
const isEN = pathname.startsWith("/en");

// Remove language prefix
let pagePath = pathname;
if (isPT) pagePath = pathname.replace(/^\/pt/, "");
if (isEN) pagePath = pathname.replace(/^\/en/, "");

// Ensure not empty
if (pagePath === "") pagePath = "/";

// Build SAME PAGE links with BASE_URL added back
const languages = [
  {
    code: "pt",
    label: "PT",
    href: `${base}${pagePath === "/" ? "/pt/" : `/pt${pagePath}`}`,
  },
  {
    code: "en",
    label: "EN",
    href: `${base}${pagePath === "/" ? "/en/" : `/en${pagePath}`}`,
  },
];
---

<div class="language-switcher">
  {languages.map((lang, index) => (
    <>
      <a
        href={lang.href}
        class={currentLang === lang.code ? "active" : ""}
      >
        {lang.label}
      </a>
      {index < languages.length - 1 && (
        <span class="divider" aria-hidden="true">|</span>
      )}
    </>
  ))}
</div>

<style>
.language-switcher {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.85rem;
  letter-spacing: 0.1em;
}

.language-switcher a {
  text-decoration: none;
  color: var(--brand);
  font-weight: 500;
  transition: color 0.2s ease;
}

.language-switcher a:hover,
.language-switcher a:focus {
  color: var(--hover-dark);
}

.language-switcher a.active {
  font-weight: 600;
  text-decoration: underline;
  text-decoration-thickness: 2px;
  text-underline-offset: 4px;
}

.language-switcher .divider {
  color: var(--muted);
  margin: 0 0.25rem;
  user-select: none;
}
</style>